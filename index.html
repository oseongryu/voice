<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>í™”ë©´ ì œì–´ - ìŒì„± í…ìŠ¤íŠ¸ ë³€í™˜</title>
  <!-- AG Grid CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-grid.css" />
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- Toast Notification Settings -->
  <script>
    /**
     * í† ìŠ¤íŠ¸ ì•Œë¦¼ ì„¤ì • (Toast Notification Settings)
     * ì›í•˜ëŠ” ì•Œë¦¼ë§Œ í‘œì‹œë˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
     */
    window.TOAST_SETTINGS = {
      // ì „ì²´ í† ìŠ¤íŠ¸ ì‹œìŠ¤í…œ í™œì„±í™” ì—¬ë¶€ (Master Switch)
      ENABLED: true,

      // ì•Œë¦¼ ì¹´í…Œê³ ë¦¬ë³„ í‘œì‹œ ì—¬ë¶€ ì„¤ì •
      // show: true (í‘œì‹œ), show: false (ìˆ¨ê¹€)
      CATEGORIES: {
        // í´ë¦­ ë° ì¢Œí‘œ ê´€ë ¨ ì•Œë¦¼
        'CLICK': {
          keywords: ['í´ë¦­', 'ì¢Œí‘œ', 'Click', 'Coordinate', 'í„°ì¹˜'],
          show: false
        },
        // ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜ ê´€ë ¨ ì•Œë¦¼
        'SCREENSHOT': {
          keywords: ['ìŠ¤í¬ë¦°ìƒ·', 'ì´¬ì˜', 'Screenshot', 'ìº¡ì²˜'],
          show: false
        },
        // ì›¹ì†Œì¼“ ë° ìŠ¤íŠ¸ë¦¬ë° ìƒíƒœ ì•Œë¦¼
        'WEBSOCKET': {
          keywords: ['ì›¹ì†Œì¼“', 'WebSocket', 'ìŠ¤íŠ¸ë¦¬ë°', 'ì—°ê²°', 'Ping'],
          show: false
        },
        // ìŒì„± ì¸ì‹ ê´€ë ¨ ì•Œë¦¼
        'VOICE': {
          keywords: ['ìŒì„±', 'ì¸ì‹', 'ëª…ë ¹', 'Voice', 'íŠ¸ë¦¬ê±°'],
          show: true
        },
        // ëª¨ë“œ ì „í™˜ ì•Œë¦¼
        'MODE': {
          keywords: ['ëª¨ë“œ', 'Mode'],
          show: false
        },
        // í…ìŠ¤íŠ¸/í‚¤ ì…ë ¥ ì•Œë¦¼
        'INPUT': {
          keywords: ['ì…ë ¥', 'íƒ€ì´í•‘', 'í‚¤', 'Input', 'Type'],
          show: false
        },
        // ì˜¤ë¥˜ ë° ê²½ê³ 
        'ERROR': {
          keywords: ['ì˜¤ë¥˜', 'ì‹¤íŒ¨', 'ê²½ê³ ', 'Error', 'Fail', 'Warning'],
          show: false
        }
      },

      // ë¶„ë¥˜ë˜ì§€ ì•Šì€ ê¸°íƒ€ ì•Œë¦¼ í‘œì‹œ ì—¬ë¶€
      SHOW_UNCATEGORIZED: false
    };
  </script>
  <link rel="stylesheet" href="css/screenshot.css" />
  <link rel="stylesheet" href="css/navbar.css" />
</head>

<body>
  <!-- Bootstrap Navbar -->
  <nav id="topNavbar" class="navbar navbar-expand navbar-light bg-light">
    <div class="container-fluid">
      <!-- Floating Header Collapse Button -->
      <button class="btn btn-sm btn-outline-secondary me-2 floating-collapse-btn" onclick="toggleFloatingHeader()"
        title="ë©”ë‰´ ìˆ¨ê¸°ê¸°" style="display: none;">
        <i class="bi bi-chevron-right"></i>
      </button>

      <!-- Brand & Mode Selector -->
      <a class="navbar-brand me-3" href="#" data-i18n="nav.brand">ì œì–´</a>

      <!-- Navbar Content -->
      <div class="navbar-collapse" id="mainNavbar">
        <!-- Screenshot Mode Controls -->
        <ul id="mainNavButtons" class="navbar-nav mb-2 mb-sm-0 align-items-center flex-row">
          <!-- Main Action: Screenshot (Visible only in Screenshot Mode) -->
          <li class="nav-item me-2" id="screenshotActionItem">
            <button id="takeScreenshotBtn" class="btn btn-primary btn-sm" onclick="takeNewScreenshot()"
              title="ìƒˆ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜">
              <i class="bi bi-camera-fill"></i> <span data-i18n="nav.screenshot">í™”ë©´</span>
            </button>
          </li>

          <!-- Text Input Button -->
          <li class="nav-item me-2">
            <button class="btn btn-outline-secondary btn-sm" onclick="showTypeTextModal()" title="í…ìŠ¤íŠ¸ ì…ë ¥">
              <i class="bi bi-keyboard"></i> <span data-i18n="nav.text">Text</span>
            </button>
          </li>



          <!-- Mouse Mode Button -->
          <li class="nav-item me-2">
            <button id="mouseModeBtn" class="btn btn-outline-secondary btn-sm" onclick="toggleMouseMode()"
              title="ë§ˆìš°ìŠ¤ ì´ë™ ëª¨ë“œ">
              <i class="bi bi-cursor-fill"></i> <span data-i18n="nav.mouse">ë§ˆìš°ìŠ¤</span>
            </button>
          </li>

          <!-- Voice Button -->
          <li class="nav-item me-2">
            <button id="voiceBtn" class="btn btn-outline-secondary btn-sm" onclick="toggleVoiceActivation()"
              title="ìŒì„± ì¸ì‹">
              <i class="bi bi-mic-fill"></i> <span data-i18n="nav.voice">ìŒì„±</span>
            </button>
          </li>

          <!-- WebSocket Toggle Button (Live Connection) -->
          <li class="nav-item me-2">
            <button id="wsToggleBtn" class="btn btn-outline-secondary btn-sm" onclick="toggleWebSocketConnection()"
              title="ë¼ì´ë¸Œ">
              <i class="bi bi-plug"></i>ë¼ì´ë¸Œ
            </button>
          </li>

          <!-- Tools Dropdown -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="toolsDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              <i class="bi bi-tools"></i> <span data-i18n="nav.tools">ë„êµ¬</span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="toolsDropdown">
              <li><button class="dropdown-item" onclick="showServerConfigModal()"><i class="bi bi-server"></i> <span>ì„œë²„ ì„¤ì •</span></button></li>
              <li><button class="dropdown-item" onclick="showSettingModal()"><i class="bi bi-gear"></i> <span
                    data-i18n="nav.tools.debug">ì„¤ì •</span></button>
              </li>
              <li><button class="dropdown-item" onclick="showVoiceSettingsModal()"><i class="bi bi-mic-fill"></i> <span
                    data-i18n="nav.tools.voice_settings">ìŒì„± ì„¤ì •</span></button>
              </li>
              <li><button class="dropdown-item" onclick="showClickRecorderModal()"><i class="bi bi-record-circle"></i>
                  <span data-i18n="nav.tools.macro">ë§¤í¬ë¡œ ê¸°ë¡</span></button></li>
              <li><button class="dropdown-item" onclick="showVoiceHistoryModal()"><i class="bi bi-journal-text"></i>
                  <span data-i18n="nav.tools.history">ìŒì„± íˆìŠ¤í† ë¦¬</span></button></li>
            </ul>
          </li>

          <!-- Coordinates -->
          <li class="nav-item me-3">
            <div id="coordinates"
              class="badge bg-dark text-wrap font-monospace d-flex justify-content-center align-items-center"
              style="font-size: 0.85rem; width: 140px;">(0, 0)</div>
          </li>

          <!-- Zoom Controls -->
          <li class="nav-item">
            <div class="btn-group btn-group-sm">
              <button class="btn btn-outline-secondary" onclick="zoomOut()" title="ì¶•ì†Œ"><i
                  class="bi bi-dash"></i></button>
              <span class="btn btn-outline-secondary disabled text-dark border-start-0 border-end-0" id="zoomLevelLabel"
                style="opacity: 1; background: #fff; min-width: 50px;">100%</span>
              <button class="btn btn-outline-secondary" onclick="zoomIn()" title="í™•ëŒ€"><i
                  class="bi bi-plus"></i></button>
              <button class="btn btn-outline-secondary" onclick="resetZoom()" title="ì´ˆê¸°í™”"><i
                  class="bi bi-arrow-counterclockwise"></i></button>
              <button class="btn btn-outline-secondary" onclick="toggleFullScreen()" title="ì „ì²´í™”ë©´"><i
                  class="bi bi-arrows-fullscreen"></i></button>
              <button class="btn btn-outline-secondary" onclick="fitToScreen()" title="ì¬ì¡°ì •"><i
                  class="bi bi-arrow-repeat"></i></button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Floating Header Controls -->
  <button id="floatingHeaderBtn" class="header-floating-btn" onclick="toggleFloatingHeader()" title="ë©”ë‰´ ì—´ê¸°">
    <i class="bi bi-list"></i>
  </button>

  <script>
    /* Floating Header Logic */
    function toggleFloatingHeader() {
      const body = document.body;
      const navbar = document.getElementById('topNavbar');

      // Toggle visibility classes
      const isVisible = body.classList.contains('header-visible');

      if (isVisible) {
        body.classList.remove('header-visible');
        navbar.classList.remove('show');
      } else {
        body.classList.add('header-visible');
        navbar.classList.add('show');
      }
    }
  </script>

  <div class="container">
    <div id="screenshotContainer" class="screenshot-container">
      <div class="screenshot-content">
        <img id="screenshotImage" class="screenshot-image" alt="ì„œë²„ í™”ë©´" />
      </div>

    </div>

    <!-- Voice Command Floating Overlay -->
    <div id="voiceCommandOverlay" class="voice-command-overlay">
      <div class="voice-command-header">
        <i class="bi bi-mic-fill"></i> <span data-i18n="voice.listening">ë“£ê³  ìˆìŠµë‹ˆë‹¤...</span>
      </div>
      <div id="voiceCommandStatus" class="voice-command-status" data-i18n="voice.status.ready">ëª…ë ¹ì„ ë§ì”€í•˜ì„¸ìš”</div>
    </div>

    <!-- bottom toast area used for general messages -->
    <div id="bottomToast" class="bottom-toast" aria-live="polite"></div>
  </div>

  <!-- Server Configuration Modal -->
  <div class="modal fade" id="serverConfigModal" tabindex="-1" aria-labelledby="serverConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="serverConfigModalLabel"><i class="bi bi-server"></i> ì„œë²„ ì„¤ì •</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info" role="alert">
            <strong>GitHub Pages ë°°í¬ ëª¨ë“œ</strong><br>
            ë°±ì—”ë“œ ì„œë²„ì˜ URLì„ ì…ë ¥í•˜ì„¸ìš”. ëª¨ë“  API ìš”ì²­ì´ ì´ ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
          </div>

          <div class="mb-3">
            <label for="serverUrlInput" class="form-label">ì„œë²„ URL</label>
            <input type="text" class="form-control" id="serverUrlInput"
                   placeholder="http://localhost:8000 ë˜ëŠ” https://your-server.com">
            <div class="form-text">ì˜ˆ: http://localhost:8000 ë˜ëŠ” https://your-server.com</div>
          </div>

          <div id="serverStatus" class="alert" style="display: none;"></div>

          <div class="d-grid gap-2">
            <button class="btn btn-primary" onclick="saveServerConfig()">ì €ì¥ ë° ì—°ê²° í…ŒìŠ¤íŠ¸</button>
          </div>

          <hr>

          <div class="mb-2">
            <strong>í˜„ì¬ ì„¤ì •:</strong>
          </div>
          <div class="mb-2">
            <code id="currentServerUrl">ë¯¸ì„¤ì •</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Setting Modal -->
  <div class="modal fade" id="settingModal" tabindex="-1" aria-labelledby="settingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="padding: 0.5rem 1rem;">
          <h6 class="modal-title" id="settingModalLabel" style="font-size: 0.95rem;">âš™ï¸ ì„¤ì •</h6>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"
            style="font-size: 0.8rem;"></button>
        </div>
        <div class="modal-body">
          <!-- UI ì„¤ì • ì„¹ì…˜ -->
          <div class="debug-section mb-4">
            <h6 class="text-primary mb-2">âš™ï¸ UI ì„¤ì •</h6>
            <div class="mb-3">
              <label for="headerModeSelect" class="form-label">í—¤ë” ìŠ¤íƒ€ì¼ (Header Style):</label>
              <select id="headerModeSelect" class="form-select" onchange="changeHeaderMode(this.value)">
                <option value="normal">ê¸°ë³¸ (Normal)</option>
                <option value="fixed">ìƒë‹¨ ê³ ì • (Sticky)</option>
                <option value="floating">í”Œë¡œíŒ… ìë™ ìˆ¨ê¹€ (Floating)</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="textModalPositionSelect" class="form-label">í…ìŠ¤íŠ¸ ì…ë ¥ íŒì—… ìœ„ì¹˜:</label>
              <select id="textModalPositionSelect" class="form-select" onchange="changeTextModalPosition(this.value)">
                <option value="top">ìƒë‹¨</option>
                <option value="center">ì¤‘ì•™</option>
                <option value="top-start">ì™¼ìª½ ìƒë‹¨</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="screenshotDelayInput" class="form-label">ìŠ¤í¬ë¦°ìƒ· ê°±ì‹  ì§€ì—°ì‹œê°„ (ms):</label>
              <div class="input-group">
                <input type="number" id="screenshotDelayInput" class="form-control" value="1000" step="100" min="0"
                  onchange="changeScreenshotDelay(this.value)">
                <span class="input-group-text">ms</span>
              </div>
              <div class="form-text" style="font-size: 0.8rem;">ì…ë ¥/í´ë¦­ í›„ í™”ë©´ ê°±ì‹ ê¹Œì§€ì˜ ëŒ€ê¸° ì‹œê°„ (ê¸°ë³¸ê°’: 1000ms)</div>
            </div>
          </div>

          <!-- ì–¸ì–´ ì„¤ì • ì„¹ì…˜ -->
          <div class="debug-section mb-4">
            <h6 class="text-primary mb-2" data-i18n="settings.language">ğŸŒ ì–¸ì–´ ì„¤ì •</h6>
            <select id="languageSelect" class="form-select" onchange="setLanguage(this.value)">
              <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
              <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            </select>
          </div>
        </div>
        <div class="modal-footer" style="padding: 0.5rem 1rem;">
          <button type="button" class="btn btn-outline-danger btn-sm" onclick="resetSettings()">
            <i class="bi bi-arrow-counterclockwise"></i> ì„¤ì • ì´ˆê¸°í™”
          </button>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Click Recorder Modal -->
  <div class="modal fade" id="clickRecorderModal" tabindex="-1" aria-labelledby="clickRecorderModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="padding: 0.5rem 1rem;">
          <h6 class="modal-title" id="clickRecorderModalLabel" style="font-size: 0.95rem;">ğŸ“¹ ë§¤í¬ë¡œ ê¸°ë¡</h6>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"
            style="font-size: 0.8rem;"></button>
        </div>
        <div class="modal-body">
          <!-- ë…¹í™” ì»¨íŠ¸ë¡¤ -->
          <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
            <button id="startRecordBtn" class="btn btn-primary btn-sm">ë…¹í™” ì‹œì‘</button>
            <button id="stopRecordBtn" class="btn btn-secondary btn-sm" style="display:none">ë…¹í™” ì¤‘ì§€</button>
            <button id="playbackBtn" class="btn btn-success btn-sm" disabled>ì¬ìƒ</button>
            <button id="deleteSelectedRecordingBtn" class="btn btn-warning btn-sm">ì„ íƒì‚­ì œ</button>
            <button id="clearRecordingBtn" class="btn btn-outline-secondary btn-sm ms-auto">ì§€ìš°ê¸°</button>
          </div>

          <!-- ë…¹í™” ì •ë³´ -->
          <div class="mb-3">
            <label class="form-label">ë…¹í™”ëœ ì´ë²¤íŠ¸ ìˆ˜: <span id="recordCount" class="badge bg-secondary">0</span></label>
          </div>

          <!-- ì¬ìƒ ì†ë„ -->
          <div class="mb-3">
            <label for="playbackSpeed" class="form-label">ì¬ìƒ ì†ë„ (ë°°ìœ¨):</label>
            <select id="playbackSpeed" class="form-select form-select-sm" style="max-width: 150px;">
              <option value="1">1x</option>
              <option value="0.5">0.5x</option>
              <option value="2">2x</option>
            </select>
          </div>

          <!-- ì´ë²¤íŠ¸ ëª©ë¡ -->
          <div class="mb-3">
            <label for="recordList" class="form-label">ì´ë²¤íŠ¸ ëª©ë¡ (ì‹œê°„, ìœ í˜•, x, y)</label>
            <textarea id="recordList" class="form-control font-monospace" style="height:160px; font-size:0.9rem;"
              readonly></textarea>
          </div>

          <!-- ë‚´ë³´ë‚´ê¸°/ë¶ˆëŸ¬ì˜¤ê¸° -->
          <div class="d-flex gap-2 mb-3">
            <button id="exportBtn" class="btn btn-outline-secondary btn-sm" disabled>ë‚´ë³´ë‚´ê¸° (JSON)</button>
            <button id="importBtn" class="btn btn-outline-secondary btn-sm ms-auto">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <input id="importFileInput" type="file" accept="application/json" style="display:none" />
          </div>

          <hr />

          <!-- ê·¸ë£¹ ì €ì¥ -->
          <div class="d-flex gap-2 align-items-center mb-3">
            <input id="saveGroupName" class="form-control form-control-sm" placeholder="ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
            <button id="saveGroupBtn" class="btn btn-primary btn-sm" disabled>ì €ì¥</button>
          </div>

          <!-- ì €ì¥ëœ ê·¸ë£¹ ê´€ë¦¬ -->
          <div class="d-flex gap-2 align-items-center mb-3">
            <label class="form-label mb-0" style="white-space:nowrap">ì €ì¥ëœ ê·¸ë£¹:</label>
            <select id="savedGroupsSelect" class="form-select form-select-sm"></select>
            <button id="loadGroupBtn" class="btn btn-outline-secondary btn-sm">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button id="deleteGroupBtn" class="btn btn-danger btn-sm">ì‚­ì œ</button>
            <button id="runGroupBtn" class="btn btn-success btn-sm">ì‹¤í–‰</button>
          </div>

          <!-- ì‚¬ìš©ë²• ì•ˆë‚´ -->
          <div class="alert alert-info mb-0" role="alert">
            <small>
              <strong>ì‚¬ìš©ë²•:</strong> ëª¨ë‹¬ì„ ì—° ìƒíƒœì—ì„œ ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€ ìœ„ë¥¼ í´ë¦­í•˜ë©´ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë…¹í™”ë©ë‹ˆë‹¤.
              ì¬ìƒ ì‹œ ì„œë²„ë¡œ ìˆœì°¨ì ìœ¼ë¡œ í´ë¦­ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Text Input Modal -->
  <div class="modal fade" id="typeTextModal" tabindex="-1" aria-labelledby="typeTextModalLabel" aria-hidden="true">
    <div class="modal-dialog" id="typeTextModalDialog">
      <div class="modal-content shadow-lg border-0 rounded-4">
        <div class="modal-body p-4">
          <!-- ì…ë ¥ ì˜ì—­ -->
          <div class="mb-3">
            <textarea id="textToType" class="form-control" rows="3" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          </div>

          <!-- ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="d-grid gap-2 mb-3">
            <div class="row g-2">
              <div class="col">
                <button class="btn btn-secondary w-100" data-bs-dismiss="modal" onclick="closeTypeTextModal()">
                  ì·¨ì†Œ
                </button>
              </div>
              <div class="col">
                <button class="btn btn-primary w-100 fw-bold" onclick="performTypeText()">
                  ì „ì†¡
                </button>
              </div>
              <div class="col">
                <button id="textModalVoiceBtn" class="btn btn-danger w-100" onclick="toggleTextModalRecording()">
                  <i class="bi bi-mic-fill"></i> ë…¹ìŒ
                </button>
              </div>
            </div>
          </div>

          <!-- íŠ¹ìˆ˜ í‚¤ ì˜ì—­ (í•­ìƒ í‘œì‹œ) -->
          <div class="mt-3" id="specialKeysArea">
            <div class="d-flex gap-3">
              <!-- ì™¼ìª½: íŠ¹ìˆ˜í‚¤ ì˜ì—­ -->
              <div class="flex-grow-1">
                <!-- ì²« ë²ˆì§¸ ì¤„: Esc(ì¢Œ), ë¹ˆê³µê°„(ì¤‘), Backspace(ìš°) -->
                <div class="d-flex flex-wrap gap-1 mb-1">
                  <button class="btn btn-light border btn-sm flex-fill" onclick="performKeyPress('escape')">Esc</button>
                  <button class="btn btn-light border btn-sm flex-fill" style="visibility: hidden;">Del</button>
                  <button class="btn btn-light border btn-sm flex-fill" onclick="performKeyPress('backspace')"
                    title="Backspace"><i class="bi bi-backspace"></i></button>
                </div>
                <!-- ë‘ ë²ˆì§¸ ì¤„: Tab(ì¢Œ), Space(ì¤‘), Enter(ìš°) -->
                <div class="d-flex flex-wrap gap-1 mb-1">
                  <button class="btn btn-light border btn-sm flex-fill" onclick="performKeyPress('tab')">Tab</button>
                  <button class="btn btn-light border btn-sm flex-fill" onclick="performKeyPress('space')">Space</button>
                  <button class="btn btn-light border btn-sm flex-fill" onclick="performKeyPress('enter')">Enter</button>
                </div>
                <!-- ì„¸ ë²ˆì§¸ ì¤„: Ctrl ë‹¨ì¶•í‚¤ -->
                <div class="d-flex gap-1 mb-3">
                  <button class="btn btn-subtle-secondary btn-sm border flex-fill"
                    onclick="performKeyCombination(['ctrl','c'])">Ctrl+C</button>
                  <button class="btn btn-subtle-secondary btn-sm border flex-fill"
                    onclick="performKeyCombination(['ctrl','v'])">Ctrl+V</button>
                  <button class="btn btn-subtle-secondary btn-sm border flex-fill"
                    onclick="performKeyCombination(['ctrl','a'])">Ctrl+A</button>
                  <button class="btn btn-subtle-secondary btn-sm border flex-fill"
                    onclick="performKeyCombination(['ctrl','z'])">Ctrl+Z</button>
                  <button class="btn btn-subtle-secondary btn-sm border flex-fill"
                    onclick="performKeyCombination(['ctrl','s'])">Ctrl+S</button>
                </div>

                <!-- ë¹ˆ ê³µê°„ ì±„ìš°ê¸° -->
                <div class="flex-grow-1 text-center text-muted small">
                  <!-- í•„ìš”ì‹œ ì—¬ê¸°ì— ì¶”ê°€ ì„¤ëª…ì´ë‚˜ ë¹ˆ ê³µê°„ ìœ ì§€ -->
                </div>
              </div>

              <!-- ì˜¤ë¥¸ìª½: ë„¤ë¹„ê²Œì´ì…˜ ë° í™”ì‚´í‘œ ì˜ì—­ -->
              <div class="d-flex flex-column gap-2">
                <!-- 6í‚¤ í´ëŸ¬ìŠ¤í„° (Ins, Home, PgUp / Del, End, PgDn) -->
                <div class="d-flex flex-column gap-1">
                  <div class="d-flex gap-1">
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('insert')">Ins</button>
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('home')">Home</button>
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('pageup')">PgUp</button>
                  </div>
                  <div class="d-flex gap-1">
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('delete')">Del</button>
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('end')">End</button>
                    <button class="btn btn-light border btn-sm" style="width: 45px;"
                      onclick="performKeyPress('pagedown')">PgDn</button>
                  </div>
                </div>

                <!-- í™”ì‚´í‘œ í‚¤ -->
                <div class="d-flex flex-column gap-1 align-items-center mt-1">
                  <div class="d-flex justify-content-center">
                    <button class="btn btn-outline-secondary btn-sm" onclick="performKeyPress('up')" style="width: 45px;">
                      <i class="bi bi-arrow-up"></i>
                    </button>
                  </div>
                  <div class="d-flex gap-1">
                    <button class="btn btn-outline-secondary btn-sm" onclick="performKeyPress('left')"
                      style="width: 45px;">
                      <i class="bi bi-arrow-left"></i>
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="performKeyPress('down')"
                      style="width: 45px;">
                      <i class="bi bi-arrow-down"></i>
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="performKeyPress('right')"
                      style="width: 45px;">
                      <i class="bi bi-arrow-right"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice History Modal -->
  <div class="modal fade" id="voiceHistoryModal" tabindex="-1" aria-labelledby="voiceHistoryModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
      <div class="modal-content">
        <div class="modal-header" style="padding: 0.5rem 1rem;">
          <h6 class="modal-title" id="voiceHistoryModalLabel" style="font-size: 0.95rem;">ğŸ¤ ìŒì„± íˆìŠ¤í† ë¦¬</h6>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"
            style="font-size: 0.8rem;"></button>
        </div>
        <div class="modal-body">
          <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ì„¹ì…˜ -->
          <div class="text-input-section mb-3">
            <div class="input-group">
              <input type="text" id="voiceTextInput" class="form-control"
                placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ê±°ë‚˜ ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”..." />
              <button id="voiceAddTextBtn" class="btn btn-primary" onclick="addTextToVoiceHistory()">
                ì¶”ê°€
              </button>
            </div>
          </div>

          <!-- ìŒì„± ë° ì œì–´ ë²„íŠ¼ -->
          <div class="voice-controls d-flex flex-wrap gap-2 mb-3">
            <button id="voiceRequestPermissionBtn" class="btn btn-outline-secondary btn-sm"
              onclick="requestVoiceMicrophonePermission()">
              ğŸ¤ ë§ˆì´í¬ ê¶Œí•œ
            </button>
            <button id="voiceRecordBtn" class="btn btn-danger btn-sm" onclick="startVoiceRecording()">
              ìŒì„±ë…¹ìŒ
            </button>
            <button id="voiceStopBtn" class="btn btn-dark btn-sm" onclick="stopVoiceRecording()" style="display: none">
              ë…¹ìŒì¤‘ì§€
            </button>
            <button id="voiceRefreshHistoryBtn" class="btn btn-secondary btn-sm" onclick="loadVoiceServerHistory()">
              ìƒˆë¡œê³ ì¹¨
            </button>
            <button id="voiceSelectAllBtn" class="btn btn-outline-secondary btn-sm" onclick="selectAllVoiceHistory()">
              ì „ì²´ì„ íƒ
            </button>
            <button id="voiceCopySelectedBtn" class="btn btn-outline-secondary btn-sm"
              onclick="copySelectedVoiceHistory()">
              ì„ íƒë³µì‚¬
            </button>
            <button id="voiceCopyToServerBtn" class="btn btn-outline-primary btn-sm"
              onclick="copySelectedToServerClipboard()">
              ì„œë²„ë³µì‚¬
            </button>
            <button id="voiceExecuteSelectedBtn" class="btn btn-success btn-sm" onclick="executeSelectedVoiceHistory()">
              ì‹¤í–‰
            </button>
            <button id="voiceDeleteSelectedBtn" class="btn btn-danger btn-sm" onclick="deleteSelectedVoiceHistory()"
              style="display: none">
              ì„ íƒì‚­ì œ
            </button>
            <button id="voiceClearServerHistoryBtn" class="btn btn-outline-danger btn-sm"
              onclick="clearVoiceServerHistory()">
              ì „ì²´ì‚­ì œ
            </button>
            <button id="voiceExportHistoryBtn" class="btn btn-outline-secondary btn-sm" onclick="exportVoiceHistory()">
              ë‚´ë³´ë‚´ê¸°
            </button>
          </div>

          <!-- íˆìŠ¤í† ë¦¬ ì¹´ìš´í„° -->
          <div class="mb-2 text-muted">
            ìŒì„± ë³€í™˜ íˆìŠ¤í† ë¦¬ <span id="voiceHistoryCounter">(ì´ 0ê°œ)</span>
          </div>

          <!-- íˆìŠ¤í† ë¦¬ ê·¸ë¦¬ë“œ -->
          <div id="voiceGridContainer" class="ag-theme-alpine"
            style="height: 400px; width: 100%; border: 1px solid #ddd; border-radius: 4px">
            <div class="loading-history d-flex align-items-center justify-content-center h-100 text-muted">
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice Settings Modal - Included inline -->
  <div class="modal fade" id="voiceSettingsModal" tabindex="-1" aria-labelledby="voiceSettingsModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
          <div class="modal-content">
              <div class="modal-header" style="padding: 0.5rem 1rem;">
                  <h6 class="modal-title" id="voiceSettingsModalLabel" style="font-size: 0.95rem;">
                      <i class="bi bi-mic-fill"></i> <span data-i18n="modal.voice.title">ìŒì„± ì„¤ì •</span>
                  </h6>
                  <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"
                      style="font-size: 0.8rem;"></button>
              </div>
              <div class="modal-body">

                  <!-- íŠ¸ë¦¬ê±° ì„¤ì • -->
                  <div class="card mb-4">
                      <div class="card-header bg-light">
                          <h6 class="mb-0" data-i18n="modal.voice.basic_settings">ê¸°ë³¸ ì„¤ì •</h6>
                      </div>
                      <div class="card-body">
                          <div class="row g-3 align-items-end">
                              <div class="col-md-7">
                                  <label for="triggerPhraseInput" class="form-label"
                                      data-i18n="modal.voice.trigger_phrase">í˜¸ì¶œì–´ (Trigger Phrase)</label>
                                  <input type="text" class="form-control" id="triggerPhraseInput" placeholder="ì˜ˆ: ì¸ì‹í•´ì¤˜"
                                      value="ì¸ì‹í•´ì¤˜">
                                  <div class="form-text" data-i18n="modal.voice.trigger_help">ìŒì„± ì¸ì‹ì„ ì‹œì‘í•  ë•Œ ë§í•˜ëŠ” í˜¸ì¶œì–´ì…ë‹ˆë‹¤.
                                  </div>
                              </div>
                              <div class="col-md-3">
                                  <label for="timeoutInput" class="form-label" data-i18n="modal.voice.timeout">ëŒ€ê¸° ì‹œê°„
                                      (ì´ˆ)</label>
                                  <input type="number" class="form-control" id="timeoutInput" placeholder="5" value="5"
                                      min="1" max="60">
                                  <div class="form-text" data-i18n="modal.voice.timeout_help">í˜¸ì¶œ í›„ ëª…ë ¹ ëŒ€ê¸° ì‹œê°„</div>
              </div>
                              <div class="col-md-2">
                                  <button class="btn btn-primary w-100" type="button" onclick="saveBasicSettings()"
                                      data-i18n="modal.voice.save">ì €ì¥</button>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- ì»¤ìŠ¤í…€ ëª…ë ¹ì–´ ëª©ë¡ -->
                  <div class="card">
                      <div class="card-header bg-light d-flex justify-content-between align-items-center">
                          <h6 class="mb-0" data-i18n="modal.voice.custom_commands">ì»¤ìŠ¤í…€ ëª…ë ¹ì–´ ê´€ë¦¬</h6>
                          <button class="btn btn-sm btn-primary" onclick="showAddCommandForm()">
                              <i class="bi bi-plus-lg"></i> <span data-i18n="modal.voice.add_command">ëª…ë ¹ì–´ ì¶”ê°€</span>
                          </button>
                      </div>
                      <div class="card-body">

                          <!-- ëª…ë ¹ì–´ ì¶”ê°€ í¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
                          <div id="addCommandForm" class="mb-4 p-3 border rounded bg-light" style="display: none;">
                              <h6 class="mb-3" data-i18n="modal.voice.new_command">ìƒˆ ëª…ë ¹ì–´ ì¶”ê°€</h6>
                              <div class="row g-3">
                                  <div class="col-md-4">
                                      <label for="newCommandPhrase" class="form-label" data-i18n="modal.voice.phrase">ëª…ë ¹ì–´
                                          (ë°œí™”)</label>
                                      <input type="text" class="form-control" id="newCommandPhrase" placeholder="ì˜ˆ: ì°°ì¹µ">
                                  </div>
                                  <div class="col-md-4">
                                      <label for="newCommandAction" class="form-label">ë™ì‘</label>
                                      <select class="form-select" id="newCommandAction">
                                          <option value="SCREENSHOT">ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜</option>
                                          <option value="REFRESH">ìƒˆë¡œê³ ì¹¨</option>
                                          <option value="ZOOM_IN">í™•ëŒ€</option>
                                          <option value="ZOOM_OUT">ì¶•ì†Œ</option>
                                          <option value="ZOOM_RESET">ì¤Œ ì´ˆê¸°í™”</option>
                                          <option value="TEXT_MODAL">í…ìŠ¤íŠ¸ ì…ë ¥ ì°½</option>
                                          <option value="HISTORY_MODAL">íˆìŠ¤í† ë¦¬ ì°½</option>
                                          <option value="DEBUG_MODAL">ì„¤ì •/ë””ë²„ê·¸ ì°½</option>
                                          <option value="CLICK_RECORDER">ë§¤í¬ë¡œ ê¸°ë¡ ì°½</option>
                                          <option value="WS_MODE">ì›¹ì†Œì¼“ ëª¨ë“œ ì „í™˜</option>
                                          <option value="SCREENSHOT_MODE">ìŠ¤í¬ë¦°ìƒ· ëª¨ë“œ ì „í™˜</option>
                                          <option value="CLOSE">ì¢…ë£Œ (ë‹«ê¸°)</option>
                                      </select>
                                  </div>
                                  <div class="col-md-4">
                                      <label for="newCommandDesc" class="form-label" data-i18n="modal.voice.desc">ì„¤ëª…
                                          (ì„ íƒ)</label>
                                      <input type="text" class="form-control" id="newCommandDesc" placeholder="ì„¤ëª…">
                                  </div>
                                  <div class="col-12 text-end">
                                      <button type="button" class="btn btn-secondary btn-sm"
                                          onclick="hideAddCommandForm()" data-i18n="modal.voice.cancel">ì·¨ì†Œ</button>
                                      <button type="button" class="btn btn-success btn-sm" onclick="addCustomCommand()"
                                          data-i18n="modal.voice.add">ì¶”ê°€</button>
                                  </div>
                              </div>
                          </div>

                          <!-- ëª©ë¡ í…Œì´ë¸” -->
                          <div class="table-responsive">
                              <table class="table table-hover">
                                  <thead>
                                      <tr>
                                          <th data-i18n="modal.voice.table.phrase">ëª…ë ¹ì–´</th>
                                          <th data-i18n="modal.voice.table.action">ë™ì‘</th>
                                          <th data-i18n="modal.voice.table.desc">ì„¤ëª…</th>
                                          <th style="width: 80px;" data-i18n="modal.voice.table.manage">ê´€ë¦¬</th>
                                      </tr>
                                  </thead>
                                  <tbody id="customCommandsTableBody">
                                      <!-- JSë¡œ ë¡œë“œë¨ -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>

              </div>

          </div>
      </div>
  </div>

  <!-- Socket.IO í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

  <!-- Server Configuration Script -->
  <script src="js/config.js"></script>

  <!-- External JavaScript modules -->
  <script src="js/auth-utils.js"></script>
  <script src="js/coordinate-utils.js"></script>
  <script src="js/text-input-utils.js"></script>
  <script src="js/screenshot-core.js"></script>
  <script src="js/screenshot-modals.js"></script>
  <script src="js/screenshot-interactions.js"></script>
  <script src="js/click-recorder.js"></script>
  <script>
    try {
      // console.log('bootstrap: click-recorder.js loaded, initGlobalRecorderButtons=', typeof initGlobalRecorderButtons);
      if (typeof initGlobalRecorderButtons === 'function') initGlobalRecorderButtons();
    } catch (e) { console.log('bootstrap error', e); }
  </script>
  <script src="js/screenshot-utils.js"></script>
  <script src="js/screenshot-voice.js"></script>
  <script src="js/mouse-mode.js"></script>

  <!-- ëª¨ë“œ ê´€ë¦¬ì -->
  <script src="js/mode-manager.js"></script>

  <!-- WebSocket í™”ë©´ì¸ì‹ ëª¨ë“ˆ -->
  <script src="js/websocket-screenshot.js"></script>
  <script src="js/websocket-utils.js"></script>

  <!-- JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ -->
  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
  <script src="js/speech-to-text.js"></script>
  <script src="js/history-api.js"></script>
  <script src="js/voice-activation.js"></script>
  <script src="js/voice-activation-integration.js"></script>
  <script src="js/i18n.js"></script>

  <!-- Voice Settings Modal Script -->
  <script>
      let modalVoiceCommands = [];

      function showVoiceSettingsModal() {
          const modal = new bootstrap.Modal(document.getElementById('voiceSettingsModal'));
          modal.show();
          loadVoiceSettings();
      }

      async function loadVoiceSettings() {
          try {
              // Load Basic Settings
              const settingsRes = await fetch(AppConfig.getApiUrl('/api/settings'));
              const settingsData = await settingsRes.json();
              if (settingsData.triggerPhrase) {
                  document.getElementById('triggerPhraseInput').value = settingsData.triggerPhrase;
              }
              if (settingsData.timeout) {
                  document.getElementById('timeoutInput').value = settingsData.timeout;
              }

              // Load Commands
              const cmdsRes = await fetch(AppConfig.getApiUrl('/api/voice-commands'));
              const cmdsData = await cmdsRes.json();
              modalVoiceCommands = cmdsData.commands || [];
              renderVoiceCommands();

          } catch (e) {
              console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
              showToast('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨', 'error');
          }
      }

      async function saveBasicSettings() {
          const phrase = document.getElementById('triggerPhraseInput').value.trim();
          const timeout = document.getElementById('timeoutInput').value;

          if (!phrase) {
              showToast(typeof t === 'function' ? t('msg.input_trigger') : 'í˜¸ì¶œì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
              return;
          }

          try {
              const res = await fetch(AppConfig.getApiUrl('/api/settings'), {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                      triggerPhrase: phrase,
                      timeout: timeout
                  })
              });
              const data = await res.json();
              if (data.success) {
                  showToast(typeof t === 'function' ? t('msg.basic_settings_saved') : 'ê¸°ë³¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                  if (window.globalVoiceActivation) {
                      window.globalVoiceActivation.triggerPhrase = phrase;
                      if (timeout) window.globalVoiceActivation.commandTimeout = parseInt(timeout) * 1000;
                  }
              } else {
                  showToast(typeof t === 'function' ? t('msg.save_fail') : 'ì €ì¥ ì‹¤íŒ¨', 'error');
              }
          } catch (e) {
              console.error('ì €ì¥ ì˜¤ë¥˜:', e);
              showToast(typeof t === 'function' ? t('msg.error') : 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
          }
      }

      function renderVoiceCommands() {
          const tbody = document.getElementById('customCommandsTableBody');
          tbody.innerHTML = '';

          const actionLabels = {
              'SCREENSHOT': typeof t === 'function' ? t('action.screenshot') : 'ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜',
              'REFRESH': typeof t === 'function' ? t('action.refresh') : 'ìƒˆë¡œê³ ì¹¨',
              'ZOOM_IN': typeof t === 'function' ? t('action.zoom_in') : 'í™•ëŒ€',
              'ZOOM_OUT': typeof t === 'function' ? t('action.zoom_out') : 'ì¶•ì†Œ',
              'ZOOM_RESET': typeof t === 'function' ? t('action.zoom_reset') : 'ì¤Œ ì´ˆê¸°í™”',
              'TEXT_MODAL': typeof t === 'function' ? t('action.text_modal') : 'í…ìŠ¤íŠ¸ ì…ë ¥ ì°½',
              'HISTORY_MODAL': typeof t === 'function' ? t('action.history_modal') : 'íˆìŠ¤í† ë¦¬ ì°½',
              'DEBUG_MODAL': typeof t === 'function' ? t('action.debug_modal') : 'ì„¤ì •/ë””ë²„ê·¸ ì°½',
              'CLICK_RECORDER': typeof t === 'function' ? t('action.macro_recorder') : 'ë§¤í¬ë¡œ ê¸°ë¡ ì°½',
              'WS_MODE': typeof t === 'function' ? t('action.ws_mode') : 'ì›¹ì†Œì¼“ ëª¨ë“œ ì „í™˜',
              'SCREENSHOT_MODE': typeof t === 'function' ? t('action.screenshot_mode') : 'ìŠ¤í¬ë¦°ìƒ· ëª¨ë“œ ì „í™˜',
              'CLOSE': typeof t === 'function' ? t('action.close') : 'ì¢…ë£Œ (ë‹«ê¸°)'
          };

          if (modalVoiceCommands.length === 0) {
              tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">ë“±ë¡ëœ ì»¤ìŠ¤í…€ ëª…ë ¹ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
              return;
          }

          modalVoiceCommands.forEach(cmd => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
          <td><span class="badge bg-light text-dark border">${cmd.phrase}</span></td>
          <td>${actionLabels[cmd.action] || cmd.action}</td>
          <td>${cmd.description || '-'}</td>
          <td>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomCommand(${cmd.id})">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        `;
              tbody.appendChild(tr);
          });
      }

      function showAddCommandForm() {
          document.getElementById('addCommandForm').style.display = 'block';
      }

      function hideAddCommandForm() {
          document.getElementById('addCommandForm').style.display = 'none';
          document.getElementById('newCommandPhrase').value = '';
          document.getElementById('newCommandDesc').value = '';
          document.getElementById('newCommandAction').value = 'SCREENSHOT';
      }

      async function addCustomCommand() {
          const phrase = document.getElementById('newCommandPhrase').value.trim();
          const action = document.getElementById('newCommandAction').value;
          const desc = document.getElementById('newCommandDesc').value.trim();

          if (!phrase) {
              showToast(typeof t === 'function' ? t('msg.input_phrase') : 'ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
              return;
          }

          try {
              const res = await fetch(AppConfig.getApiUrl('/api/voice-commands'), {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ phrase, action, description: desc })
              });
              const data = await res.json();
              if (data.success) {
                  showToast(typeof t === 'function' ? t('msg.command_added') : 'ëª…ë ¹ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                  hideAddCommandForm();
                  loadVoiceSettings(); // Reload list
                  if (window.loadVoiceIntegrationSettings) window.loadVoiceIntegrationSettings();
              } else {
                  showToast('ì¶”ê°€ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
              }
          } catch (e) {
              console.error('ì¶”ê°€ ì˜¤ë¥˜:', e);
              showToast(typeof t === 'function' ? t('msg.error') : 'ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
          }
      }

      async function deleteCustomCommand(id) {
          if (!confirm(typeof t === 'function' ? t('msg.confirm_delete') : 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

          try {
              const res = await fetch(AppConfig.getApiUrl(`/api/voice-commands/${id}`), {
                  method: 'DELETE'
              });
              const data = await res.json();
              if (data.success) {
                  showToast(typeof t === 'function' ? t('msg.command_deleted') : 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                  loadVoiceSettings();
                  if (window.loadVoiceIntegrationSettings) window.loadVoiceIntegrationSettings();
              } else {
                  showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
              }
          } catch (e) {
              console.error('ì‚­ì œ ì˜¤ë¥˜:', e);
              showToast(typeof t === 'function' ? t('msg.error') : 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
          }
      }
  </script>

  <!-- Server Config Modal Script -->
  <script>
    function showServerConfigModal() {
      const modal = new bootstrap.Modal(document.getElementById('serverConfigModal'));
      const input = document.getElementById('serverUrlInput');
      const currentUrl = document.getElementById('currentServerUrl');

      // Show current server URL
      input.value = AppConfig.getServerUrl();
      currentUrl.textContent = AppConfig.getServerUrl() || 'ë¯¸ì„¤ì •';

      modal.show();
    }

    async function saveServerConfig() {
      const input = document.getElementById('serverUrlInput');
      const statusDiv = document.getElementById('serverStatus');
      const url = input.value.trim();

      if (!url) {
        statusDiv.className = 'alert alert-danger';
        statusDiv.textContent = 'ì„œë²„ URLì„ ì…ë ¥í•˜ì„¸ìš”';
        statusDiv.style.display = 'block';
        return;
      }

      // Save URL
      if (!AppConfig.setServerUrl(url)) {
        statusDiv.className = 'alert alert-danger';
        statusDiv.textContent = 'ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤';
        statusDiv.style.display = 'block';
        return;
      }

      // Test connection
      statusDiv.className = 'alert alert-info';
      statusDiv.textContent = 'ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
      statusDiv.style.display = 'block';

      const isConnected = await AppConfig.testConnection();

      if (isConnected) {
        statusDiv.className = 'alert alert-success';
        statusDiv.textContent = 'âœ“ ì„œë²„ ì—°ê²° ì„±ê³µ! ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
        document.getElementById('currentServerUrl').textContent = url;

        // Auto close after 2 seconds
        setTimeout(() => {
          bootstrap.Modal.getInstance(document.getElementById('serverConfigModal')).hide();
        }, 2000);
      } else {
        statusDiv.className = 'alert alert-warning';
        statusDiv.textContent = 'âš  ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì´ ì €ì¥ë˜ì—ˆì§€ë§Œ ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      }
    }

    // Show server config modal if no server URL is set
    document.addEventListener('DOMContentLoaded', () => {
      if (!localStorage.getItem('serverUrl')) {
        setTimeout(() => {
          showServerConfigModal();
        }, 1000);
      }
    });
  </script>

  <!-- ì¸ì¦ ì²˜ë¦¬ ì œê±° (GitHub Pagesì—ì„œëŠ” ì¸ì¦ ë¶ˆí•„ìš”) -->
  <script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‘ì—… (ì¸ì¦ ì²´í¬ ì œê±°)
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Voice Coding Client - GitHub Pages Version');
      console.log('Server URL:', AppConfig.getServerUrl());
    });
  </script>

  <!-- Bootstrap Bundle with Popper (Required for Dropdowns) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
</body>

</html>
